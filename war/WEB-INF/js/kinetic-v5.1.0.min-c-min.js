var Kinetic={};
!function(c){var b=Math.PI/180;Kinetic={version:"5.1.0",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,dragDistance:0,angleDeg:!0,UA:function(){var a=c.navigator&&c.navigator.userAgent||"",b=a.toLowerCase(),b=/(chrome)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||0>b.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||[],
a=!!a.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);return{browser:b[1]||"",version:b[2]||"0",mobile:a}}(),Filters:{},Node:function(a){this._init(a)},Shape:function(a){this.__init(a)},Container:function(a){this.__init(a)},Stage:function(a){this.___init(a)},BaseLayer:function(a){this.___init(a)},Layer:function(a){this.____init(a)},FastLayer:function(a){this.____init(a)},Group:function(a){this.___init(a)},isDragging:function(){var a=Kinetic.DD;return a?a.isDragging:!1},isDragReady:function(){var a=
Kinetic.DD;return a?!!a.node:!1},_addId:function(a,b){void 0!==b&&(this.ids[b]=a)},_removeId:function(a){void 0!==a&&delete this.ids[a]},_addName:function(a,b){void 0!==b&&(void 0===this.names[b]&&(this.names[b]=[]),this.names[b].push(a))},_removeName:function(a,b){if(void 0!==a){var d=this.names[a];if(void 0!==d){for(var f=0;f<d.length;f++)d[f]._id===b&&d.splice(f,1);0===d.length&&delete this.names[a]}}},getAngle:function(a){return this.angleDeg?a*b:a}}}(this);
(function(c,b){if("object"==typeof exports){var a=require("canvas"),e=require("jsdom").jsdom,e=e("<!DOCTYPE html><html><head></head><body></body></html>"),d=b();return Kinetic.document=e,Kinetic.window=Kinetic.document.createWindow(),Kinetic.window.Image=a.Image,Kinetic.root=c,Kinetic._nodeCanvas=a,void(module.exports=d)}"function"==typeof define&&define.amd&&define(b);Kinetic.document=document;Kinetic.window=window;Kinetic.root=c})((0,eval)("this"),function(){return Kinetic});
!function(){Kinetic.Collection=function(){var d=[].slice.call(arguments),a=d.length,b=0;for(this.length=a;a>b;b++)this[b]=d[b];return this};Kinetic.Collection.prototype=[];Kinetic.Collection.prototype.each=function(d){for(var a=0;a<this.length;a++)d(this[a],a)};Kinetic.Collection.prototype.toArray=function(){var d,a=[],b=this.length;for(d=0;b>d;d++)a.push(this[d]);return a};Kinetic.Collection.toCollection=function(d){var a,b=new Kinetic.Collection,e=d.length;for(a=0;e>a;a++)b.push(d[a]);return b};
Kinetic.Collection._mapMethod=function(d){Kinetic.Collection.prototype[d]=function(){var a,b=this.length,e=[].slice.call(arguments);for(a=0;b>a;a++)this[a][d].apply(this[a],e);return this}};Kinetic.Collection.mapMethods=function(d){d=d.prototype;for(var a in d)Kinetic.Collection._mapMethod(a)};Kinetic.Transform=function(d){this.m=d&&d.slice()||[1,0,0,1,0,0]};Kinetic.Transform.prototype={copy:function(){return new Kinetic.Transform(this.m)},point:function(d){var a=this.m;return{x:a[0]*d.x+a[2]*d.y+
a[4],y:a[1]*d.x+a[3]*d.y+a[5]}},translate:function(d,a){return this.m[4]+=this.m[0]*d+this.m[2]*a,this.m[5]+=this.m[1]*d+this.m[3]*a,this},scale:function(d,a){return this.m[0]*=d,this.m[1]*=d,this.m[2]*=a,this.m[3]*=a,this},rotate:function(d){var a=Math.cos(d);d=Math.sin(d);var b=this.m[1]*a+this.m[3]*d,e=this.m[0]*-d+this.m[2]*a,c=this.m[1]*-d+this.m[3]*a;return this.m[0]=this.m[0]*a+this.m[2]*d,this.m[1]=b,this.m[2]=e,this.m[3]=c,this},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},
skew:function(a,b){var e=this.m[1]+this.m[3]*b,c=this.m[2]+this.m[0]*a,g=this.m[3]+this.m[1]*a;return this.m[0]+=this.m[2]*b,this.m[1]=e,this.m[2]=c,this.m[3]=g,this},multiply:function(a){var b=this.m[1]*a.m[0]+this.m[3]*a.m[1],e=this.m[0]*a.m[2]+this.m[2]*a.m[3],c=this.m[1]*a.m[2]+this.m[3]*a.m[3],g=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],h=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];return this.m[0]=this.m[0]*a.m[0]+this.m[2]*a.m[1],this.m[1]=b,this.m[2]=e,this.m[3]=c,this.m[4]=g,this.m[5]=
h,this},invert:function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=-this.m[1]*a,e=-this.m[2]*a,c=this.m[0]*a,g=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),h=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=this.m[3]*a,this.m[1]=b,this.m[2]=e,this.m[3]=c,this.m[4]=g,this.m[5]=h,this},getMatrix:function(){return this.m},setAbsolutePosition:function(a,b){var e=this.m[0],c=this.m[1],g=this.m[2],h=this.m[4],c=(e*(b-this.m[5])-c*(a-h))/(e*this.m[3]-c*g);return this.translate((a-h-
g*c)/e,c)}};var c=Math.PI/180,b=180/Math.PI,a={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},e=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(a){return!(!a||1!=a.nodeType)},
_isFunction:function(a){return!!(a&&a.constructor&&a.call&&a.apply)},_isObject:function(a){return!!a&&a.constructor==Object},_isArray:function(a){return"[object Array]"==Object.prototype.toString.call(a)},_isNumber:function(a){return"[object Number]"==Object.prototype.toString.call(a)},_isString:function(a){return"[object String]"==Object.prototype.toString.call(a)},_throttle:function(a,b,e){var c,g,h,l=null,q=0;e||(e={});var n=function(){q=!1===e.leading?0:(new Date).getTime();l=null;h=a.apply(c,
g);c=g=null};return function(){var p=(new Date).getTime();q||!1!==e.leading||(q=p);var r=b-(p-q);return c=this,g=arguments,0>=r?(clearTimeout(l),l=null,q=p,h=a.apply(c,g),c=g=null):l||!1===e.trailing||(l=setTimeout(n,r)),h}},_hasMethods:function(a){var b,e=[];for(b in a)this._isFunction(a[b])&&e.push(b);return 0<e.length},createCanvasElement:function(){var a=Kinetic.document.createElement("canvas");return a.style=a.style||{},a},isBrowser:function(){return"object"!=typeof exports},_isInDocument:function(a){for(;a=
a.parentNode;)if(a==Kinetic.document)return!0;return!1},_simplifyArray:function(a){var b,e,c=[],g=a.length,h=Kinetic.Util;for(b=0;g>b;b++)e=a[b],h._isNumber(e)?e=Math.round(1E3*e)/1E3:h._isString(e)||(e=e.toString()),c.push(e);return c},_getImage:function(a,b){var e,c;a?this._isElement(a)?b(a):this._isString(a)?(e=new Kinetic.window.Image,e.onload=function(){b(e)},e.src=a):a.data?(c=Kinetic.Util.createCanvasElement(),c.width=a.width,c.height=a.height,c.getContext("2d").putImageData(a,0,0),this._getImage(c.toDataURL(),
b)):b(null):b(null)},_getRGBAString:function(a){return["rgba(",a.red||0,",",a.green||0,",",a.blue||0,",",a.alpha||1,")"].join("")},_rgbToHex:function(a,b,e){return(16777216+(a<<16)+(b<<8)+e).toString(16).slice(1)},_hexToRgb:function(a){a=a.replace("#","");a=parseInt(a,16);return{r:a>>16&255,g:a>>8&255,b:255&a}},getRandomColor:function(){for(var a=(16777215*Math.random()<<0).toString(16);6>a.length;)a="0"+a;return"#"+a},get:function(a,b){return void 0===a?b:a},getRGB:function(b){var f;return b in a?
(f=a[b],{r:f[0],g:f[1],b:f[2]}):"#"===b[0]?this._hexToRgb(b.substring(1)):"rgb("===b.substr(0,4)?(f=e.exec(b.replace(/ /g,"")),{r:parseInt(f[1],10),g:parseInt(f[2],10),b:parseInt(f[3],10)}):{r:0,g:0,b:0}},_merge:function(a,b){var e=this._clone(b),c;for(c in a)e[c]=this._isObject(a[c])?this._merge(a[c],e[c]):a[c];return e},cloneObject:function(a){var b={},e;for(e in a)b[e]=this._isObject(a[e])?this.cloneObject(a[e]):this._isArray(a[e])?this.cloneArray(a[e]):a[e];return b},cloneArray:function(a){return a.slice(0)},
_degToRad:function(a){return a*c},_radToDeg:function(a){return a*b},_capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},error:function(a){throw Error("Kinetic error: "+a);},warn:function(a){Kinetic.root.console&&console.warn&&console.warn("Kinetic warning: "+a)},extend:function(a,b){for(var e in b.prototype)e in a.prototype||(a.prototype[e]=b.prototype[e])},addMethods:function(a,b){for(var e in b)a.prototype[e]=b[e]},_getControlPoints:function(a,b,e,c,g,h,l){var q=Math.sqrt(Math.pow(e-
a,2)+Math.pow(c-b,2)),n=Math.sqrt(Math.pow(g-e,2)+Math.pow(h-c,2)),p=l*q/(q+n);l=l*n/(q+n);return[e-p*(g-a),c-p*(h-b),e+l*(g-a),c+l*(h-b)]},_expandPoints:function(a,b){var e,c,g=a.length,h=[];for(e=2;g-2>e;e+=2)c=Kinetic.Util._getControlPoints(a[e-2],a[e-1],a[e],a[e+1],a[e+2],a[e+3],b),h.push(c[0]),h.push(c[1]),h.push(a[e]),h.push(a[e+1]),h.push(c[2]),h.push(c[3]);return h},_removeLastLetter:function(a){return a.substring(0,a.length-1)}}}();
!function(){var c=Kinetic.Util.createCanvasElement().getContext("2d"),b=Kinetic.UA.mobile?(window.devicePixelRatio||1)/(c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||c.backingStorePixelRatio||1):1;Kinetic.Canvas=function(a){this.init(a)};Kinetic.Canvas.prototype={init:function(a){a=a||{};this.pixelRatio=a.pixelRatio||Kinetic.pixelRatio||b;this._canvas=Kinetic.Util.createCanvasElement();this._canvas.style.padding=0;this._canvas.style.margin=
0;this._canvas.style.border=0;this._canvas.style.background="transparent";this._canvas.style.position="absolute";this._canvas.style.top=0;this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(a){this.pixelRatio=a;this.setSize(this.getWidth(),this.getHeight())},setWidth:function(a){this.width=this._canvas.width=a*this.pixelRatio;this._canvas.style.width=a+"px"},setHeight:function(a){this.height=this._canvas.height=
a*this.pixelRatio;this._canvas.style.height=a+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(a,b){this.setWidth(a);this.setHeight(b)},toDataURL:function(a,b){try{return this._canvas.toDataURL(a,b)}catch(d){try{return this._canvas.toDataURL()}catch(f){return Kinetic.Util.warn("Unable to get data URL. "+f.message),""}}}};Kinetic.SceneCanvas=function(a){a=a||{};var b=a.width||0,d=a.height||0;Kinetic.Canvas.call(this,a);this.context=new Kinetic.SceneContext(this);
this.setSize(b,d)};Kinetic.SceneCanvas.prototype={setWidth:function(a){var b=this.pixelRatio,d=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,a);d.scale(b,b)},setHeight:function(a){var b=this.pixelRatio,d=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,a);d.scale(b,b)}};Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas);Kinetic.HitCanvas=function(a){a=a||{};var b=a.width||0,d=a.height||0;Kinetic.Canvas.call(this,a);this.context=new Kinetic.HitContext(this);
this.setSize(b,d)};Kinetic.Util.extend(Kinetic.HitCanvas,Kinetic.Canvas)}();
!function(){var c="arc arcTo beginPath bezierCurveTo clearRect clip closePath createLinearGradient createPattern createRadialGradient drawImage fill fillText getImageData createImageData lineTo moveTo putImageData quadraticCurveTo rect restore rotate save scale setLineDash setTransform stroke strokeText transform translate".split(" ");Kinetic.Context=function(b){this.init(b)};Kinetic.Context.prototype={init:function(b){this.canvas=b;this._context=b._canvas.getContext("2d");Kinetic.enableTrace&&(this.traceArr=
[],this._enableTrace())},fillShape:function(b){b.getFillEnabled()&&this._fill(b)},strokeShape:function(b){b.getStrokeEnabled()&&this._stroke(b)},fillStrokeShape:function(b){b.getFillEnabled()&&this._fill(b);b.getStrokeEnabled()&&this._stroke(b)},getTrace:function(b){var a,e,d,f,c=this.traceArr,k=c.length,g="";for(a=0;k>a;a++)e=c[a],(d=e.method)?(f=e.args,g+=d,g+=b?"()":Kinetic.Util._isArray(f[0])?"(["+f.join(",")+"])":"("+f.join(",")+")"):(g+=e.property,b||(g+="="+e.val)),g+=";";return g},clearTrace:function(){this.traceArr=
[]},_trace:function(b){var a=this.traceArr;a.push(b);a.length>=Kinetic.traceArrMax&&a.shift()},reset:function(){var b=this.getCanvas().getPixelRatio();this.setTransform(1*b,0,0,1*b,0,0)},getCanvas:function(){return this.canvas},clear:function(b){var a=this.getCanvas();b?this.clearRect(b.x||0,b.y||0,b.width||0,b.height||0):this.clearRect(0,0,a.getWidth(),a.getHeight())},_applyLineCap:function(b){(b=b.getLineCap())&&this.setAttr("lineCap",b)},_applyOpacity:function(b){b=b.getAbsoluteOpacity();1!==b&&
this.setAttr("globalAlpha",b)},_applyLineJoin:function(b){(b=b.getLineJoin())&&this.setAttr("lineJoin",b)},setAttr:function(b,a){this._context[b]=a},arc:function(){var b=arguments;this._context.arc(b[0],b[1],b[2],b[3],b[4],b[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var b=arguments;this._context.bezierCurveTo(b[0],b[1],b[2],b[3],b[4],b[5])},clearRect:function(){var b=arguments;this._context.clearRect(b[0],b[1],b[2],b[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},
createImageData:function(){var b=arguments;return 2===b.length?this._context.createImageData(b[0],b[1]):1===b.length?this._context.createImageData(b[0]):void 0},createLinearGradient:function(){var b=arguments;return this._context.createLinearGradient(b[0],b[1],b[2],b[3])},createPattern:function(){var b=arguments;return this._context.createPattern(b[0],b[1])},createRadialGradient:function(){var b=arguments;return this._context.createRadialGradient(b[0],b[1],b[2],b[3],b[4],b[5])},drawImage:function(){var b=
arguments,a=this._context;3===b.length?a.drawImage(b[0],b[1],b[2]):5===b.length?a.drawImage(b[0],b[1],b[2],b[3],b[4]):9===b.length&&a.drawImage(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8])},fill:function(){this._context.fill()},fillText:function(){var b=arguments;this._context.fillText(b[0],b[1],b[2])},getImageData:function(){var b=arguments;return this._context.getImageData(b[0],b[1],b[2],b[3])},lineTo:function(){var b=arguments;this._context.lineTo(b[0],b[1])},moveTo:function(){var b=arguments;
this._context.moveTo(b[0],b[1])},rect:function(){var b=arguments;this._context.rect(b[0],b[1],b[2],b[3])},putImageData:function(){var b=arguments;this._context.putImageData(b[0],b[1],b[2])},quadraticCurveTo:function(){var b=arguments;this._context.quadraticCurveTo(b[0],b[1],b[2],b[3])},restore:function(){this._context.restore()},rotate:function(){this._context.rotate(arguments[0])},save:function(){this._context.save()},scale:function(){var b=arguments;this._context.scale(b[0],b[1])},setLineDash:function(){var b=
arguments,a=this._context;this._context.setLineDash?a.setLineDash(b[0]):"mozDash"in a?a.mozDash=b[0]:"webkitLineDash"in a&&(a.webkitLineDash=b[0])},setTransform:function(){var b=arguments;this._context.setTransform(b[0],b[1],b[2],b[3],b[4],b[5])},stroke:function(){this._context.stroke()},strokeText:function(){var b=arguments;this._context.strokeText(b[0],b[1],b[2])},transform:function(){var b=arguments;this._context.transform(b[0],b[1],b[2],b[3],b[4],b[5])},translate:function(){var b=arguments;this._context.translate(b[0],
b[1])},_enableTrace:function(){var b,a,e=this,d=c.length,f=Kinetic.Util._simplifyArray,m=this.setAttr,k=function(b){var d,c=e[b];e[b]=function(){return a=f(Array.prototype.slice.call(arguments,0)),d=c.apply(e,arguments),e._trace({method:b,args:a}),d}};for(b=0;d>b;b++)k(c[b]);e.setAttr=function(){m.apply(e,arguments);e._trace({property:arguments[0],val:arguments[1]})}}};Kinetic.SceneContext=function(b){Kinetic.Context.call(this,b)};Kinetic.SceneContext.prototype={_fillColor:function(b){var a=b.fill()||
Kinetic.Util._getRGBAString({red:b.fillRed(),green:b.fillGreen(),blue:b.fillBlue(),alpha:b.fillAlpha()});this.setAttr("fillStyle",a);b._fillFunc(this)},_fillPattern:function(b){var a=b.getFillPatternImage(),e=b.getFillPatternX(),d=b.getFillPatternY(),f=b.getFillPatternScale(),c=Kinetic.getAngle(b.getFillPatternRotation()),k=b.getFillPatternOffset();b=b.getFillPatternRepeat();(e||d)&&this.translate(e||0,d||0);c&&this.rotate(c);f&&this.scale(f.x,f.y);k&&this.translate(-1*k.x,-1*k.y);this.setAttr("fillStyle",
this.createPattern(a,b||"repeat"));this.fill()},_fillLinearGradient:function(b){var a=b.getFillLinearGradientStartPoint(),e=b.getFillLinearGradientEndPoint();b=b.getFillLinearGradientColorStops();a=this.createLinearGradient(a.x,a.y,e.x,e.y);if(b){for(e=0;e<b.length;e+=2)a.addColorStop(b[e],b[e+1]);this.setAttr("fillStyle",a);this.fill()}},_fillRadialGradient:function(b){var a=b.getFillRadialGradientStartPoint(),e=b.getFillRadialGradientEndPoint(),d=b.getFillRadialGradientStartRadius(),f=b.getFillRadialGradientEndRadius();
b=b.getFillRadialGradientColorStops();a=this.createRadialGradient(a.x,a.y,d,e.x,e.y,f);for(e=0;e<b.length;e+=2)a.addColorStop(b[e],b[e+1]);this.setAttr("fillStyle",a);this.fill()},_fill:function(b){var a=b.fill()||b.fillRed()||b.fillGreen()||b.fillBlue(),e=b.getFillPatternImage(),d=b.getFillLinearGradientColorStops(),f=b.getFillRadialGradientColorStops(),c=b.getFillPriority();a&&"color"===c?this._fillColor(b):e&&"pattern"===c?this._fillPattern(b):d&&"linear-gradient"===c?this._fillLinearGradient(b):
f&&"radial-gradient"===c?this._fillRadialGradient(b):a?this._fillColor(b):e?this._fillPattern(b):d?this._fillLinearGradient(b):f&&this._fillRadialGradient(b)},_stroke:function(b){var a=b.dash(),e=b.getStrokeScaleEnabled();b.hasStroke()&&(e||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(b),a&&b.dashEnabled()&&this.setLineDash(a),this.setAttr("lineWidth",b.strokeWidth()),this.setAttr("strokeStyle",b.stroke()||Kinetic.Util._getRGBAString({red:b.strokeRed(),green:b.strokeGreen(),blue:b.strokeBlue(),
alpha:b.strokeAlpha()})),b._strokeFunc(this),e||this.restore())},_applyShadow:function(b){var a=Kinetic.Util,e=b.getAbsoluteOpacity(),d=a.get(b.getShadowColor(),"black"),f=a.get(b.getShadowBlur(),5),c=a.get(b.getShadowOpacity(),1);b=a.get(b.getShadowOffset(),{x:0,y:0});c&&this.setAttr("globalAlpha",c*e);this.setAttr("shadowColor",d);this.setAttr("shadowBlur",f);this.setAttr("shadowOffsetX",b.x);this.setAttr("shadowOffsetY",b.y)}};Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context);Kinetic.HitContext=
function(b){Kinetic.Context.call(this,b)};Kinetic.HitContext.prototype={_fill:function(b){this.save();this.setAttr("fillStyle",b.colorKey);b._fillFuncHit(this);this.restore()},_stroke:function(b){b.hasStroke()&&(this._applyLineCap(b),this.setAttr("lineWidth",b.strokeWidth()),this.setAttr("strokeStyle",b.colorKey),b._strokeFuncHit(this))}};Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)}();
!function(){Kinetic.Factory={addGetterSetter:function(c,b,a,e,d){this.addGetter(c,b,a);this.addSetter(c,b,e,d);this.addOverloadedGetterSetter(c,b)},addGetter:function(c,b,a){var e="get"+Kinetic.Util._capitalize(b);c.prototype[e]=function(){var d=this.attrs[b];return void 0===d?a:d}},addSetter:function(c,b,a,e){var d="set"+Kinetic.Util._capitalize(b);c.prototype[d]=function(d){return a&&(d=a.call(this,d)),this._setAttr(b,d),e&&e.call(this),this}},addComponentsGetterSetter:function(c,b,a,e,d){var f,
m,k=a.length,g=Kinetic.Util._capitalize,h="get"+g(b),l="set"+g(b);c.prototype[h]=function(){var d={};for(f=0;k>f;f++)m=a[f],d[m]=this.getAttr(b+g(m));return d};c.prototype[l]=function(a){var f,c=this.attrs[b];e&&(a=e.call(this,a));for(f in a)this._setAttr(b+g(f),a[f]);return this._fireChangeEvent(b,c,a),d&&d.call(this),this};this.addOverloadedGetterSetter(c,b)},addOverloadedGetterSetter:function(c,b){var a=Kinetic.Util._capitalize(b),e="set"+a,d="get"+a;c.prototype[b]=function(){return arguments.length?
(this[e](arguments[0]),this):this[d]()}},backCompat:function(c,b){for(var a in b)c.prototype[a]=c.prototype[b[a]]},afterSetFilter:function(){this._filterUpToDate=!1}};Kinetic.Validators={RGBComponent:function(c){return 255<c?255:0>c?0:Math.round(c)},alphaComponent:function(c){return 1<c?1:1E-4>c?1E-4:c}}}();
!function(){var c="Shape",b=["id"];Kinetic.Util.addMethods(Kinetic.Node,{_init:function(a){var b=this;this._id=Kinetic.idCounter++;this.eventListeners={};this.attrs={};this._cache={};this._filterUpToDate=!1;this.setAttrs(a);this.on("xChange.kinetic yChange.kinetic scaleXChange.kinetic scaleYChange.kinetic skewXChange.kinetic skewYChange.kinetic rotationChange.kinetic offsetXChange.kinetic offsetYChange.kinetic transformsEnabledChange.kinetic",function(){this._clearCache("transform");b._clearSelfAndDescendantCache("absoluteTransform")});
this.on("visibleChange.kinetic",function(){b._clearSelfAndDescendantCache("visible")});this.on("listeningChange.kinetic",function(){b._clearSelfAndDescendantCache("listening")});this.on("opacityChange.kinetic",function(){b._clearSelfAndDescendantCache("absoluteOpacity")})},_clearCache:function(a){a?delete this._cache[a]:this._cache={}},_getCache:function(a,b){return void 0===this._cache[a]&&(this._cache[a]=b.call(this)),this._cache[a]},_clearSelfAndDescendantCache:function(a){this._clearCache(a);
this.children&&this.getChildren().each(function(b){b._clearSelfAndDescendantCache(a)})},clearCache:function(){return delete this._cache.canvas,this._filterUpToDate=!1,this},cache:function(a){var b=a||{};a=b.x||0;var d=b.y||0,f=b.width||this.width(),c=b.height||this.height(),b=b.drawBorder||!1;this.getLayer();if(0===f||0===c)return void Kinetic.Util.warn("Width or height of caching configuration equals 0. Cache is ignored.");var k=new Kinetic.SceneCanvas({pixelRatio:1,width:f,height:c}),g=new Kinetic.SceneCanvas({pixelRatio:1,
width:f,height:c}),h=new Kinetic.HitCanvas({width:f,height:c}),l=(this.transformsEnabled(),this.x(),this.y(),k.getContext()),q=h.getContext();return this.clearCache(),l.save(),q.save(),b&&(l.save(),l.beginPath(),l.rect(0,0,f,c),l.closePath(),l.setAttr("strokeStyle","red"),l.setAttr("lineWidth",5),l.stroke(),l.restore()),l.translate(-1*a,-1*d),q.translate(-1*a,-1*d),"Shape"===this.nodeType&&(l.translate(-1*this.x(),-1*this.y()),q.translate(-1*this.x(),-1*this.y())),this.drawScene(k,this),this.drawHit(h,
this),l.restore(),q.restore(),this._cache.canvas={scene:k,filter:g,hit:h},this},_drawCachedSceneCanvas:function(a){a.save();this.getLayer()._applyTransform(this,a);a.drawImage(this._getCachedSceneCanvas()._canvas,0,0);a.restore()},_getCachedSceneCanvas:function(){var a,b,d,f,c=this.filters(),k=this._cache.canvas,g=k.scene,k=k.filter,h=k.getContext();if(c){if(!this._filterUpToDate){try{for(a=c.length,h.clear(),h.drawImage(g._canvas,0,0),b=h.getImageData(0,0,k.getWidth(),k.getHeight()),d=0;a>d;d++)f=
c[d],f.call(this,b),h.putImageData(b,0,0)}catch(l){Kinetic.Util.warn("Unable to apply filter. "+l.message)}this._filterUpToDate=!0}return k}return g},_drawCachedHitCanvas:function(a){var b=this._cache.canvas.hit;a.save();this.getLayer()._applyTransform(this,a);a.drawImage(b._canvas,0,0);a.restore()},on:function(a,b){var d,f,c,k=a.split(" "),g=k.length;for(d=0;g>d;d++)f=k[d],c=f.split("."),f=c[0],c=c[1]||"",this.eventListeners[f]||(this.eventListeners[f]=[]),this.eventListeners[f].push({name:c,handler:b});
return this},off:function(a){var b,d,f,c,k,g=a.split(" "),h=g.length;for(a=0;h>a;a++)if(d=g[a],f=d.split("."),c=f[0],k=f[1],c)this.eventListeners[c]&&this._off(c,k);else for(b in this.eventListeners)this._off(b,k);return this},dispatchEvent:function(a){this.fire(a.type,{target:this,type:a.type,evt:a})},addEventListener:function(a,b){this.on(a,function(a){b.call(this,a.evt)})},remove:function(){var a=this.getParent();return a&&a.children&&(a.children.splice(this.index,1),a._setChildrenIndices(),delete this.parent),
this._clearSelfAndDescendantCache("stage"),this._clearSelfAndDescendantCache("absoluteTransform"),this._clearSelfAndDescendantCache("visible"),this._clearSelfAndDescendantCache("listening"),this._clearSelfAndDescendantCache("absoluteOpacity"),this},destroy:function(){Kinetic._removeId(this.getId());Kinetic._removeName(this.getName(),this._id);this.remove()},getAttr:function(a){var b="get"+Kinetic.Util._capitalize(a);return Kinetic.Util._isFunction(this[b])?this[b]():this.attrs[a]},getAncestors:function(){for(var a=
this.getParent(),b=new Kinetic.Collection;a;)b.push(a),a=a.getParent();return b},getAttrs:function(){return this.attrs||{}},setAttrs:function(a){var b,d;if(a)for(b in a)"children"===b||(d="set"+Kinetic.Util._capitalize(b),Kinetic.Util._isFunction(this[d])?this[d](a[b]):this._setAttr(b,a[b]));return this},isListening:function(){return this._getCache("listening",this._isListening)},_isListening:function(){var a=this.getListening(),b=this.getParent();return"inherit"===a?b?b.isListening():!0:a},isVisible:function(){return this._getCache("visible",
this._isVisible)},_isVisible:function(){var a=this.getVisible(),b=this.getParent();return"inherit"===a?b?b.isVisible():!0:a},shouldDrawHit:function(){var a=this.getLayer();return a&&a.hitGraphEnabled()&&this.isListening()&&this.isVisible()&&!Kinetic.isDragging()},show:function(){return this.setVisible(!0),this},hide:function(){return this.setVisible(!1),this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function a(l){b=[];d=l.length;for(f=0;d>f;f++)m=l[f],h++,m.nodeType!==
c&&(b=b.concat(m.getChildren().toArray())),m._id===g._id&&(f=d);0<b.length&&b[0].getDepth()<=k&&a(b)}var b,d,f,m,k=this.getDepth(),g=this,h=0;return"Stage"!==g.nodeType&&a(g.getStage().getChildren()),h},getDepth:function(){for(var a=0,b=this.parent;b;)a++,b=b.parent;return a},setPosition:function(a){return this.setX(a.x),this.setY(a.y),this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var a=this.getAbsoluteTransform().getMatrix(),b=new Kinetic.Transform,
d=this.offset();return b.m=a.slice(),b.translate(d.x,d.y),b.getTranslation()},setAbsolutePosition:function(a){var b,d=this._clearTransform();return this.attrs.x=d.x,this.attrs.y=d.y,delete d.x,delete d.y,b=this.getAbsoluteTransform(),b.invert(),b.translate(a.x,a.y),a={x:this.attrs.x+b.getTranslation().x,y:this.attrs.y+b.getTranslation().y},this.setPosition({x:a.x,y:a.y}),this._setTransform(d),this},_setTransform:function(a){for(var b in a)this.attrs[b]=a[b];this._clearCache("transform");this._clearSelfAndDescendantCache("absoluteTransform")},
_clearTransform:function(){var a={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform"),a},
move:function(a){var b=a.x;a=a.y;var d=this.getX(),f=this.getY();return void 0!==b&&(d+=b),void 0!==a&&(f+=a),this.setPosition({x:d,y:f}),this},_eachAncestorReverse:function(a,b){var d,f,c=[];d=this.getParent();if(b&&b._id===this._id)return a(this),!0;for(c.unshift(this);d&&(!b||d._id!==b._id);)c.unshift(d),d=d.parent;d=c.length;for(f=0;d>f;f++)a(c[f])},rotate:function(a){return this.setRotation(this.getRotation()+a),this},moveToTop:function(){return this.parent?(this.parent.children.splice(this.index,
1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):void Kinetic.Util.warn("Node has no parent. moveToTop function is ignored.")},moveUp:function(){if(!this.parent)return void Kinetic.Util.warn("Node has no parent. moveUp function is ignored.");var a=this.index;return this.parent.getChildren().length-1>a?(this.parent.children.splice(a,1),this.parent.children.splice(a+1,0,this),this.parent._setChildrenIndices(),!0):!1},moveDown:function(){if(!this.parent)return void Kinetic.Util.warn("Node has no parent. moveDown function is ignored.");
var a=this.index;return 0<a?(this.parent.children.splice(a,1),this.parent.children.splice(a-1,0,this),this.parent._setChildrenIndices(),!0):!1},moveToBottom:function(){if(!this.parent)return void Kinetic.Util.warn("Node has no parent. moveToBottom function is ignored.");var a=this.index;return 0<a?(this.parent.children.splice(a,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1},setZIndex:function(a){return this.parent?(this.parent.children.splice(this.index,1),this.parent.children.splice(a,
0,this),this.parent._setChildrenIndices(),this):void Kinetic.Util.warn("Node has no parent. zIndex parameter is ignored.")},getAbsoluteOpacity:function(){return this._getCache("absoluteOpacity",this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var a=this.getOpacity();return this.getParent()&&(a*=this.getParent().getAbsoluteOpacity()),a},moveTo:function(a){return Kinetic.Node.prototype.remove.call(this),a.add(this),this},toObject:function(){var a,b,d,f,c=Kinetic.Util,k={},g=this.getAttrs();
k.attrs={};for(a in g)b=g[a],c._isFunction(b)||c._isElement(b)||c._isObject(b)&&c._hasMethods(b)||(d=this[a],delete g[a],f=d?d.call(this):null,g[a]=b,f!==b&&(k.attrs[a]=b));return k.className=this.getClassName(),k},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){var a=this.getParent();return a?a.getLayer():null},getStage:function(){return this._getCache("stage",this._getStage)},_getStage:function(){var a=this.getParent();return a?
a.getStage():void 0},fire:function(a,b,d){return d?this._fireAndBubble(a,b||{}):this._fire(a,b||{}),this},getAbsoluteTransform:function(a){return a?this._getAbsoluteTransform(a):this._getCache("absoluteTransform",this._getAbsoluteTransform)},_getAbsoluteTransform:function(a){var b,d,c=new Kinetic.Transform;return this._eachAncestorReverse(function(a){b=a.transformsEnabled();d=a.getTransform();"all"===b?c.multiply(d):"position"===b&&c.translate(a.x(),a.y())},a),c},getTransform:function(){return this._getCache("transform",
this._getTransform)},_getTransform:function(){var a=new Kinetic.Transform,b=this.getX(),d=this.getY(),c=Kinetic.getAngle(this.getRotation()),m=this.getScaleX(),k=this.getScaleY(),g=this.getSkewX(),h=this.getSkewY(),l=this.getOffsetX(),q=this.getOffsetY();return(0!==b||0!==d)&&a.translate(b,d),0!==c&&a.rotate(c),(0!==g||0!==h)&&a.skew(g,h),(1!==m||1!==k)&&a.scale(m,k),(0!==l||0!==q)&&a.translate(-1*l,-1*q),a},clone:function(a){var c,d,f,m;d=this.getClassName();f=Kinetic.Util.cloneObject(this.attrs);
for(m in b)delete f[b[m]];for(c in a)f[c]=a[c];var k=new Kinetic[d](f);for(c in this.eventListeners)for(a=this.eventListeners[c],d=a.length,f=0;d>f;f++)m=a[f],0>m.name.indexOf("kinetic")&&(k.eventListeners[c]||(k.eventListeners[c]=[]),k.eventListeners[c].push(m));return k},toDataURL:function(a){a=a||{};var b=a.mimeType||null,d=a.quality||null,c=this.getStage(),m=a.x||0,k=a.y||0;a=new Kinetic.SceneCanvas({width:a.width||this.getWidth()||(c?c.getWidth():0),height:a.height||this.getHeight()||(c?c.getHeight():
0),pixelRatio:1});c=a.getContext();return c.save(),(m||k)&&c.translate(-1*m,-1*k),this.drawScene(a),c.restore(),a.toDataURL(b,d)},toImage:function(a){Kinetic.Util._getImage(this.toDataURL(a),function(b){a.callback(b)})},setSize:function(a){return this.setWidth(a.width),this.setHeight(a.height),this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||
this.nodeType},getType:function(){return this.nodeType},getDragDistance:function(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Kinetic.dragDistance},_get:function(a){return this.nodeType===a?[this]:[]},_off:function(a,b){var d,c,m=this.eventListeners[a];for(d=0;d<m.length;d++)if(c=m[d].name,!("kinetic"===c&&"kinetic"!==b||b&&c!==b)){if(m.splice(d,1),0===m.length){delete this.eventListeners[a];break}d--}},_fireChangeEvent:function(a,b,d){this._fire(a+
"Change",{oldVal:b,newVal:d})},setId:function(a){var b=this.getId();return Kinetic._removeId(b),Kinetic._addId(this,a),this._setAttr("id",a),this},setName:function(a){var b=this.getName();return Kinetic._removeName(b,this._id),Kinetic._addName(this,a),this._setAttr("name",a),this},setAttr:function(){var a=Array.prototype.slice.call(arguments),b=a[0],a=a[1],d=this["set"+Kinetic.Util._capitalize(b)];return Kinetic.Util._isFunction(d)?d.call(this,a):this._setAttr(b,a),this},_setAttr:function(a,b){var d;
void 0!==b&&(d=this.attrs[a],this.attrs[a]=b,this._fireChangeEvent(a,d,b))},_setComponentAttr:function(a,b,d){var c;void 0!==d&&(c=this.attrs[a],c||(this.attrs[a]=this.getAttr(a)),this.attrs[a][b]=d,this._fireChangeEvent(a,c,d))},_fireAndBubble:function(a,b,d){var f=!0;b&&this.nodeType===c&&(b.target=this);"mouseenter"===a&&d&&this._id===d._id?f=!1:"mouseleave"===a&&d&&this._id===d._id&&(f=!1);f&&(this._fire(a,b),b&&!b.cancelBubble&&this.parent&&(d&&d.parent?this._fireAndBubble.call(this.parent,a,
b,d.parent):this._fireAndBubble.call(this.parent,a,b)))},_fire:function(a,b){var d,c=this.eventListeners[a];if(b.type=a,c)for(d=0;d<c.length;d++)c[d].handler.call(this,b)},draw:function(){return this.drawScene(),this.drawHit(),this}});Kinetic.Node.create=function(a,b){return this._createNode(JSON.parse(a),b)};Kinetic.Node._createNode=function(a,b){var d,c,m;d=Kinetic.Node.prototype.getClassName.call(a);var k=a.children;if(b&&(a.attrs.container=b),d=new Kinetic[d](a.attrs),k)for(c=k.length,m=0;c>m;m++)d.add(this._createNode(k[m]));
return d};Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"position");Kinetic.Factory.addGetterSetter(Kinetic.Node,"x",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"y",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"opacity",1);Kinetic.Factory.addGetter(Kinetic.Node,"name");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"name");Kinetic.Factory.addGetter(Kinetic.Node,"id");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"id");Kinetic.Factory.addGetterSetter(Kinetic.Node,"rotation",
0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"scale",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleX",1);Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleY",1);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"skew",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewX",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"offset",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetX",
0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetY",0);Kinetic.Factory.addSetter(Kinetic.Node,"dragDistance");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"dragDistance");Kinetic.Factory.addSetter(Kinetic.Node,"width",0);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"width");Kinetic.Factory.addSetter(Kinetic.Node,"height",0);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"height");Kinetic.Factory.addGetterSetter(Kinetic.Node,"listening","inherit");Kinetic.Factory.addGetterSetter(Kinetic.Node,
"filters",void 0,function(a){return this._filterUpToDate=!1,a});Kinetic.Factory.addGetterSetter(Kinetic.Node,"visible","inherit");Kinetic.Factory.addGetterSetter(Kinetic.Node,"transformsEnabled","all");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"size");Kinetic.Factory.backCompat(Kinetic.Node,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});Kinetic.Collection.mapMethods(Kinetic.Node)}();
!function(){function c(a){Kinetic.root.setTimeout(a,1E3/60)}function b(){return e.apply(Kinetic.root,arguments)}var a=function(){return Kinetic.root.performance&&Kinetic.root.performance.now?function(){return Kinetic.root.performance.now()}:function(){return(new Date).getTime()}}(),e=Kinetic.root.requestAnimationFrame||Kinetic.root.webkitRequestAnimationFrame||Kinetic.root.mozRequestAnimationFrame||Kinetic.root.oRequestAnimationFrame||Kinetic.root.msRequestAnimationFrame||c;Kinetic.Animation=function(b,
d){var c=Kinetic.Animation;this.func=b;this.setLayers(d);this.id=c.animIdCounter++;this.frame={time:0,timeDiff:0,lastTime:a()}};Kinetic.Animation.prototype={setLayers:function(a){var b=[];this.layers=b=a?0<a.length?a:[a]:[]},getLayers:function(){return this.layers},addLayer:function(a){var b,d,c=this.layers;if(c)for(b=c.length,d=0;b>d;d++){if(c[d]._id===a._id)return!1}else this.layers=[];return this.layers.push(a),!0},isRunning:function(){var a,b=Kinetic.Animation.animations,d=b.length;for(a=0;d>
a;a++)if(b[a].id===this.id)return!0;return!1},start:function(){var b=Kinetic.Animation;this.stop();this.frame.timeDiff=0;this.frame.lastTime=a();b._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(a){this.frame.timeDiff=a-this.frame.lastTime;this.frame.lastTime=a;this.frame.time+=this.frame.timeDiff;this.frame.frameRate=1E3/this.frame.timeDiff}};Kinetic.Animation.animations=[];Kinetic.Animation.animIdCounter=0;Kinetic.Animation.animRunning=
!1;Kinetic.Animation._addAnimation=function(a){this.animations.push(a);this._handleAnimation()};Kinetic.Animation._removeAnimation=function(a){var b=a.id,d=this.animations,c=d.length;for(a=0;c>a;a++)if(d[a].id===b){this.animations.splice(a,1);break}};Kinetic.Animation._runFrames=function(){var b,d,c,e,h,l,q,n,p={},r=this.animations;for(e=0;e<r.length;e++){b=r[e];d=b.layers;c=b.func;b._updateFrameObject(a());l=d.length;for(h=0;l>h;h++)q=d[h],void 0!==q._id&&(p[q._id]=q);c&&c.call(b,b.frame)}for(n in p)p[n].draw()};
Kinetic.Animation._animationLoop=function(){var a=Kinetic.Animation;a.animations.length?(b(a._animationLoop),a._runFrames()):a.animRunning=!1};Kinetic.Animation._handleAnimation=function(){this.animRunning||(this.animRunning=!0,this._animationLoop())};var d=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(a){d.call(this,a)};Kinetic.Layer.prototype.batchDraw=function(){var b=this,d=Kinetic.Animation;this.batchAnim||(this.batchAnim=new d(function(){b.lastBatchDrawTime&&500<a()-b.lastBatchDrawTime&&
b.batchAnim.stop()},this));this.lastBatchDrawTime=a();this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())};Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(a){a.batchDraw()})}}((0,eval)("this"));
!function(){Kinetic.DD={anim:new Kinetic.Animation,isDragging:!1,offset:{x:0,y:0},node:null,_drag:function(a){var b=Kinetic.DD,d=b.node;if(d){if(!b.isDragging){var c=d.getStage().getPointerPosition(),m=d.dragDistance(),c=Math.max(Math.abs(c.x-b.startPointerPos.x),Math.abs(c.y-b.startPointerPos.y));if(m>c)return}d._setDragPosition(a);b.isDragging||(b.isDragging=!0,d.fire("dragstart",{type:"dragstart",target:d,evt:a},!0));d.fire("dragmove",{type:"dragmove",target:d,evt:a},!0)}},_endDragBefore:function(a){var b,
d=Kinetic.DD,c=d.node;c&&(b=c.getLayer(),d.anim.stop(),d.isDragging&&(d.isDragging=!1,Kinetic.listenClickTap=!1,a&&(a.dragEndNode=c)),delete d.node,(b||c).draw())},_endDragAfter:function(a){a=a||{};var b=a.dragEndNode;a&&b&&b.fire("dragend",{type:"dragend",target:b,evt:a},!0)}};Kinetic.Node.prototype.startDrag=function(){var a=Kinetic.DD,b=this.getStage(),d=this.getLayer(),b=b.getPointerPosition(),c=this.getAbsolutePosition();b&&(a.node&&a.node.stopDrag(),a.node=this,a.startPointerPos=b,a.offset.x=
b.x-c.x,a.offset.y=b.y-c.y,a.anim.setLayers(d||this.getLayers()),a.anim.start(),this._setDragPosition())};Kinetic.Node.prototype._setDragPosition=function(a){var b=Kinetic.DD,d=this.getStage().getPointerPosition(),c=this.getDragBoundFunc();d&&(b={x:d.x-b.offset.x,y:d.y-b.offset.y},void 0!==c&&(b=c.call(this,b,a)),this.setAbsolutePosition(b))};Kinetic.Node.prototype.stopDrag=function(){var a=Kinetic.DD,b={};a._endDragBefore(b);a._endDragAfter(b)};Kinetic.Node.prototype.setDraggable=function(a){this._setAttr("draggable",
a);this._dragChange()};var c=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var a=Kinetic.DD;a.node&&a.node._id===this._id&&this.stopDrag();c.call(this)};Kinetic.Node.prototype.isDragging=function(){var a=Kinetic.DD;return a.node&&a.node._id===this._id&&a.isDragging};Kinetic.Node.prototype._listenDrag=function(){var a=this;this._dragCleanup();"Stage"===this.getClassName()?this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(b){Kinetic.DD.node||a.startDrag(b)}):
this.on("mousedown.kinetic touchstart.kinetic",function(b){Kinetic.DD.node||a.startDrag(b)})};Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var a=this.getStage(),b=Kinetic.DD;a&&b.node&&b.node._id===this._id&&b.node.stopDrag()}};Kinetic.Node.prototype._dragCleanup=function(){"Stage"===this.getClassName()?(this.off("contentMousedown.kinetic"),this.off("contentTouchstart.kinetic")):(this.off("mousedown.kinetic"),this.off("touchstart.kinetic"))};
Kinetic.Factory.addGetterSetter(Kinetic.Node,"dragBoundFunc");Kinetic.Factory.addGetter(Kinetic.Node,"draggable",!1);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"draggable");var b=Kinetic.document.documentElement;b.addEventListener("mouseup",Kinetic.DD._endDragBefore,!0);b.addEventListener("touchend",Kinetic.DD._endDragBefore,!0);b.addEventListener("mouseup",Kinetic.DD._endDragAfter,!1);b.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)}();
!function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(c){this.children=new Kinetic.Collection;Kinetic.Node.call(this,c)},getChildren:function(c){if(c){var b=new Kinetic.Collection;return this.children.each(function(a){c(a)&&b.push(a)}),b}return this.children},hasChildren:function(){return 0<this.getChildren().length},removeChildren:function(){for(var c,b=Kinetic.Collection.toCollection(this.children),a=0;a<b.length;a++)c=b[a],delete c.parent,c.index=0,c.hasChildren()&&c.removeChildren(),
c.remove();return this.children=new Kinetic.Collection,this},destroyChildren:function(){for(var c,b=Kinetic.Collection.toCollection(this.children),a=0;a<b.length;a++)c=b[a],delete c.parent,c.index=0,c.destroy();return this.children=new Kinetic.Collection,this},add:function(c){if(!(1<arguments.length)){if(c.getParent())return void c.moveTo(this);var b=this.children;return this._validateAdd(c),c.index=b.length,c.parent=this,b.push(c),this._fire("add",{child:c}),this}for(b=0;b<arguments.length;b++)this.add(arguments[b])},
destroy:function(){this.hasChildren()&&this.destroyChildren();Kinetic.Node.prototype.destroy.call(this)},find:function(c){var b,a,e,d,f=[],m=c.replace(/ /g,"").split(","),k=m.length;for(c=0;k>c;c++)if(a=m[c],"#"===a.charAt(0))(b=this._getNodeById(a.slice(1)))&&f.push(b);else if("."===a.charAt(0))b=this._getNodesByName(a.slice(1)),f=f.concat(b);else for(e=this.getChildren(),d=e.length,b=0;d>b;b++)f=f.concat(e[b]._get(a));return Kinetic.Collection.toCollection(f)},_getNodeById:function(c){c=Kinetic.ids[c];
return void 0!==c&&this.isAncestorOf(c)?c:null},_getNodesByName:function(c){return this._getDescendants(Kinetic.names[c]||[])},_get:function(c){for(var b=Kinetic.Node.prototype._get.call(this,c),a=this.getChildren(),e=a.length,d=0;e>d;d++)b=b.concat(a[d]._get(c));return b},toObject:function(){var c=Kinetic.Node.prototype.toObject.call(this);c.children=[];for(var b=this.getChildren(),a=b.length,e=0;a>e;e++)c.children.push(b[e].toObject());return c},_getDescendants:function(c){for(var b=[],a=c.length,
e=0;a>e;e++){var d=c[e];this.isAncestorOf(d)&&b.push(d)}return b},isAncestorOf:function(c){for(c=c.getParent();c;){if(c._id===this._id)return!0;c=c.getParent()}return!1},clone:function(c){var b=Kinetic.Node.prototype.clone.call(this,c);return this.getChildren().each(function(a){b.add(a.clone())}),b},getAllIntersections:function(c){var b=[];return this.find("Shape").each(function(a){a.isVisible()&&a.intersects(c)&&b.push(a)}),b},_setChildrenIndices:function(){this.children.each(function(c,b){c.index=
b})},drawScene:function(c,b){var a=this.getLayer(),e=(a=c||a&&a.getCanvas())&&a.getContext(),d=this._cache.canvas,d=d&&d.scene;return this.isVisible()&&(d?this._drawCachedSceneCanvas(e):this._drawChildren(a,"drawScene",b)),this},drawHit:function(c,b){var a=this.getLayer(),e=(a=c||a&&a.hitCanvas)&&a.getContext(),d=this._cache.canvas,d=d&&d.hit;return this.shouldDrawHit()&&(d?this._drawCachedHitCanvas(e):this._drawChildren(a,"drawHit",b)),this},_drawChildren:function(c,b,a){var e,d,f=this.getLayer(),
m=c&&c.getContext(),k=this.getClipWidth(),g=this.getClipHeight(),h=k&&g;h&&f&&(e=this.getClipX(),d=this.getClipY(),m.save(),f._applyTransform(this,m),m.beginPath(),m.rect(e,d,k,g),m.clip(),m.reset());this.children.each(function(d){d[b](c,a)});h&&m.restore()}});Kinetic.Util.extend(Kinetic.Container,Kinetic.Node);Kinetic.Container.prototype.get=Kinetic.Container.prototype.find;Kinetic.Factory.addComponentsGetterSetter(Kinetic.Container,"clip",["x","y","width","height"]);Kinetic.Factory.addGetterSetter(Kinetic.Container,
"clipX");Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipY");Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipWidth");Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipHeight");Kinetic.Collection.mapMethods(Kinetic.Container)}();
!function(){function c(a){a.fill()}function b(a){a.stroke()}function a(a){a.fill()}function e(a){a.stroke()}function d(){this._clearCache(f)}var f="hasShadow";Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(f){this.nodeType="Shape";this._fillFunc=c;this._strokeFunc=b;this._fillFuncHit=a;this._strokeFuncHit=e;for(var k,g=Kinetic.shapes;k=Kinetic.Util.getRandomColor(),!k||k in g;);this.colorKey=k;g[k]=this;Kinetic.Node.call(this,f);this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic shadowEnabledChange.kinetic",
d)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(f,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||
this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return!!(this.stroke()||this.strokeRed()||this.strokeGreen()||this.strokeBlue())},_get:function(a){return this.className===a||this.nodeType===a?[this]:[]},intersects:function(a){var b,d=this.getStage().bufferHitCanvas;return d.getContext().clear(),this.drawScene(d),b=d.context.getImageData(Math.round(a.x),Math.round(a.y),1,1).data,0<b[3]},destroy:function(){Kinetic.Node.prototype.destroy.call(this);
delete Kinetic.shapes[this.colorKey]},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasFill()&&this.hasStroke()&&this.getStage()},drawScene:function(a,b){var d,c,f,e=this.getLayer(),n=(a||e.getCanvas()).getContext(),p=this._cache.canvas,r=this.sceneFunc(),s=this.hasShadow();return this.isVisible()&&(p?this._drawCachedSceneCanvas(n):r&&(n.save(),this._useBufferCanvas()?(d=this.getStage(),c=d.bufferCanvas,f=c.getContext(),f.clear(),f.save(),f._applyLineJoin(this),
e._applyTransform(this,f,b),r.call(this,f),f.restore(),s&&(n.save(),n._applyShadow(this),n.drawImage(c._canvas,0,0),n.restore()),n._applyOpacity(this),n.drawImage(c._canvas,0,0)):(n._applyLineJoin(this),e._applyTransform(this,n,b),s&&(n.save(),n._applyShadow(this),r.call(this,n),n.restore()),n._applyOpacity(this),r.call(this,n)),n.restore())),this},drawHit:function(a,b){var d=this.getLayer(),c=(a||d.hitCanvas).getContext(),f=this.hitFunc()||this.sceneFunc(),e=this._cache.canvas,e=e&&e.hit;return this.shouldDrawHit()&&
(e?this._drawCachedHitCanvas(c):f&&(c.save(),c._applyLineJoin(this),d._applyTransform(this,c,b),f.call(this,c),c.restore())),this},drawHitFromCache:function(a){var b,d,c,f,e,n,p,r;a=a||0;var s=this._cache.canvas,u=this._getCachedSceneCanvas(),A=u.getContext(),s=s.hit.getContext(),t=u.getWidth(),u=u.getHeight();s.clear();try{b=A.getImageData(0,0,t,u);d=b.data;c=s.getImageData(0,0,t,u);f=c.data;e=d.length;n=Kinetic.Util._hexToRgb(this.colorKey);for(p=0;e>p;p+=4)r=d[p+3],r>a&&(f[p]=n.r,f[p+1]=n.g,f[p+
2]=n.b,f[p+3]=255);s.putImageData(c,0,0)}catch(v){Kinetic.Util.warn("Unable to draw hit graph from cached scene canvas. "+v.message)}return this}});Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"stroke");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeRed",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeGreen",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeBlue",0,
Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeAlpha",1,Kinetic.Validators.alphaComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeWidth",2);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineJoin");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineCap");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"sceneFunc");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"hitFunc");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dash");Kinetic.Factory.addGetterSetter(Kinetic.Shape,
"shadowColor");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowRed",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowGreen",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlue",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowAlpha",1,Kinetic.Validators.alphaComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlur");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOpacity");
Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"shadowOffset",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternImage");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fill");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRed",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillGreen",0,Kinetic.Validators.RGBComponent);
Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillBlue",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillAlpha",1,Kinetic.Validators.alphaComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,
"fillRadialGradientEndRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRepeat","repeat");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",
!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPriority","color");Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternOffset",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternScale",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleX",1);Kinetic.Factory.addGetterSetter(Kinetic.Shape,
"fillPatternScaleY",1);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,
"fillLinearGradientEndPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,
"fillRadialGradientEndPointY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRotation",0);Kinetic.Factory.backCompat(Kinetic.Shape,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});Kinetic.Collection.mapMethods(Kinetic.Shape)}();
!function(){function c(a,c){a.content.addEventListener(c,function(e){a[b+c](e)},!1)}var b="_",a="mousedown mousemove mouseup mouseout touchstart touchmove touchend mouseover".split(" "),e=a.length;Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(a){this.nodeType="Stage";Kinetic.Container.call(this,a);this._id=Kinetic.idCounter++;this._buildDOM();this._bindContentEvents();this._enableNestedTransforms=!1;Kinetic.stages.push(this)},_validateAdd:function(a){"Layer"!==a.getType()&&Kinetic.Util.error("You may only add layers to the stage.")},
setContainer:function(a){if("string"===typeof a){var b=a;if(a=Kinetic.document.getElementById(a),!a)throw"Can not find container in document with id "+b;}return this._setAttr("container",a),this},shouldDrawHit:function(){return!0},draw:function(){return Kinetic.Node.prototype.draw.call(this),this},setHeight:function(a){return Kinetic.Node.prototype.setHeight.call(this,a),this._resizeDOM(),this},setWidth:function(a){return Kinetic.Node.prototype.setWidth.call(this,a),this._resizeDOM(),this},clear:function(){var a,
b=this.children,c=b.length;for(a=0;c>a;a++)b[a].clear();return this},clone:function(a){return a||(a={}),a.container=Kinetic.document.createElement("div"),Kinetic.Container.prototype.clone.call(this,a)},destroy:function(){var a=this.content;Kinetic.Container.prototype.destroy.call(this);a&&Kinetic.Util._isInDocument(a)&&this.getContainer().removeChild(a);a=Kinetic.stages.indexOf(this);-1<a&&Kinetic.stages.splice(a,1)},getPointerPosition:function(){return this.pointerPos},getStage:function(){return this},
getContent:function(){return this.content},toDataURL:function(a){function b(g){var h=n[g].toDataURL(),s=new Kinetic.window.Image;s.onload=function(){q.drawImage(s,0,0);g<n.length-1?b(g+1):a.callback(l.toDataURL(c,e))};s.src=h}a=a||{};var c=a.mimeType||null,e=a.quality||null,g=a.x||0,h=a.y||0,l=new Kinetic.SceneCanvas({width:a.width||this.getWidth(),height:a.height||this.getHeight(),pixelRatio:1}),q=l.getContext()._context,n=this.children;(g||h)&&q.translate(-1*g,-1*h);b(0)},toImage:function(a){var b=
a.callback;a.callback=function(a){Kinetic.Util._getImage(a,function(a){b(a)})};this.toDataURL(a)},getIntersection:function(a){var b,c,e=this.getChildren();for(b=e.length-1;0<=b;b--)if(c=e[b].getIntersection(a))return c;return null},_resizeDOM:function(){if(this.content){var a,b,c=this.getWidth(),e=this.getHeight(),g=this.getChildren(),h=g.length;this.content.style.width=c+"px";this.content.style.height=e+"px";this.bufferCanvas.setSize(c,e);this.bufferHitCanvas.setSize(c,e);for(a=0;h>a;a++)b=g[a],
b.getCanvas().setSize(c,e),b.hitCanvas.setSize(c,e),b.draw()}},add:function(a){if(!(1<arguments.length))return Kinetic.Container.prototype.add.call(this,a),a._setCanvasSize(this.width(),this.height()),a.draw(),this.content.appendChild(a.canvas._canvas),this;for(var b=0;b<arguments.length;b++)this.add(arguments[b])},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_bindContentEvents:function(){for(var b=0;e>b;b++)c(this,a[b])},_mouseover:function(a){Kinetic.UA.mobile||
(this._setPointerPosition(a),this._fire("contentMouseover",{evt:a}))},_mouseout:function(a){if(!Kinetic.UA.mobile){this._setPointerPosition(a);var b=this.targetShape;b&&!Kinetic.isDragging()&&(b._fireAndBubble("mouseout",{evt:a}),b._fireAndBubble("mouseleave",{evt:a}),this.targetShape=null);this.pointerPos=void 0;this._fire("contentMouseout",{evt:a})}},_mousemove:function(a){if(!Kinetic.UA.mobile){this._setPointerPosition(a);var b=Kinetic.DD,c=this.getIntersection(this.getPointerPosition());c&&c.isListening()?
Kinetic.isDragging()||this.targetShape&&this.targetShape._id===c._id?c._fireAndBubble("mousemove",{evt:a}):(this.targetShape&&(this.targetShape._fireAndBubble("mouseout",{evt:a},c),this.targetShape._fireAndBubble("mouseleave",{evt:a},c)),c._fireAndBubble("mouseover",{evt:a},this.targetShape),c._fireAndBubble("mouseenter",{evt:a},this.targetShape),this.targetShape=c):this.targetShape&&!Kinetic.isDragging()&&(this.targetShape._fireAndBubble("mouseout",{evt:a}),this.targetShape._fireAndBubble("mouseleave",
{evt:a}),this.targetShape=null);this._fire("contentMousemove",{evt:a});b&&b._drag(a)}a.preventDefault&&a.preventDefault()},_mousedown:function(a){if(!Kinetic.UA.mobile){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0;b&&b.isListening()&&(this.clickStartShape=b,b._fireAndBubble("mousedown",{evt:a}));this._fire("contentMousedown",{evt:a})}a.preventDefault&&a.preventDefault()},_mouseup:function(a){if(!Kinetic.UA.mobile){this._setPointerPosition(a);
var b=this.getIntersection(this.getPointerPosition()),c=this.clickStartShape,e=!1;Kinetic.inDblClickWindow?(e=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0;setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow);b&&b.isListening()&&(b._fireAndBubble("mouseup",{evt:a}),Kinetic.listenClickTap&&c&&c._id===b._id&&(b._fireAndBubble("click",{evt:a}),e&&b._fireAndBubble("dblclick",{evt:a})));this._fire("contentMouseup",{evt:a});Kinetic.listenClickTap&&(this._fire("contentClick",
{evt:a}),e&&this._fire("contentDblclick",{evt:a}));Kinetic.listenClickTap=!1}a.preventDefault&&a.preventDefault()},_touchstart:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0;b&&b.isListening()&&(this.tapStartShape=b,b._fireAndBubble("touchstart",{evt:a}),b.isListening()&&a.preventDefault&&a.preventDefault());this._fire("contentTouchstart",{evt:a})},_touchend:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),
c=!1;Kinetic.inDblClickWindow?(c=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0;setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow);b&&b.isListening()&&(b._fireAndBubble("touchend",{evt:a}),Kinetic.listenClickTap&&b._id===this.tapStartShape._id&&(b._fireAndBubble("tap",{evt:a}),c&&b._fireAndBubble("dbltap",{evt:a})),b.isListening()&&a.preventDefault&&a.preventDefault());Kinetic.listenClickTap&&(this._fire("contentTouchend",{evt:a}),c&&this._fire("contentDbltap",
{evt:a}));Kinetic.listenClickTap=!1},_touchmove:function(a){this._setPointerPosition(a);var b=Kinetic.DD,c=this.getIntersection(this.getPointerPosition());c&&c.isListening()&&(c._fireAndBubble("touchmove",{evt:a}),c.isListening()&&a.preventDefault&&a.preventDefault());this._fire("contentTouchmove",{evt:a});b&&b._drag(a)},_setPointerPosition:function(a){var b,c=this._getContentPosition(),e=a.offsetX,g=a.clientX,h=null,l=null;a=a?a:window.event;void 0!==a.touches?0<a.touches.length&&(b=a.touches[0],
h=b.clientX-c.left,l=b.clientY-c.top):void 0!==e?(h=e,l=a.offsetY):"mozilla"===Kinetic.UA.browser?(h=a.layerX,l=a.layerY):void 0!==g&&c&&(h=g-c.left,l=a.clientY-c.top);null!==h&&null!==l&&(this.pointerPos={x:h,y:l})},_getContentPosition:function(){var a=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return{top:a.top,left:a.left}},_buildDOM:function(){var a=this.getContainer();if(!a){if(Kinetic.Util.isBrowser())throw"Stage has not container. But container is required";
a=Kinetic.document.createElement("div")}a.innerHTML="";this.content=Kinetic.document.createElement("div");this.content.style.position="relative";this.content.style.display="inline-block";this.content.className="kineticjs-content";this.content.setAttribute("role","presentation");a.appendChild(this.content);this.bufferCanvas=new Kinetic.SceneCanvas({pixelRatio:1});this.bufferHitCanvas=new Kinetic.HitCanvas;this._resizeDOM()},_onContent:function(a,b){var c,e,g=a.split(" "),h=g.length;for(c=0;h>c;c++)e=
g[c],this.content.addEventListener(e,b,!1)},cache:function(){Kinetic.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.")},clearCache:function(){}});Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container);Kinetic.Factory.addGetter(Kinetic.Stage,"container");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Stage,"container")}();
!function(){Kinetic.Util.addMethods(Kinetic.BaseLayer,{___init:function(c){this.nodeType="Layer";Kinetic.Container.call(this,c)},createPNGStream:function(){return this.canvas._canvas.createPNGStream()},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(c){return this.getContext().clear(c),this.getHitCanvas().getContext().clear(c),this},setZIndex:function(c){Kinetic.Node.prototype.setZIndex.call(this,
c);var b=this.getStage();return b&&(b.content.removeChild(this.getCanvas()._canvas),c<b.getChildren().length-1?b.content.insertBefore(this.getCanvas()._canvas,b.getChildren()[c+1].getCanvas()._canvas):b.content.appendChild(this.getCanvas()._canvas)),this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var c=this.getStage();c&&(c.content.removeChild(this.getCanvas()._canvas),c.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var c=
this.getStage();c&&(c.content.removeChild(this.getCanvas()._canvas),this.index<c.getChildren().length-1?c.content.insertBefore(this.getCanvas()._canvas,c.getChildren()[this.index+1].getCanvas()._canvas):c.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var c=this.getStage();if(c){var b=c.getChildren();c.content.removeChild(this.getCanvas()._canvas);c.content.insertBefore(this.getCanvas()._canvas,b[this.index+1].getCanvas()._canvas)}}},
moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var c=this.getStage();if(c){var b=c.getChildren();c.content.removeChild(this.getCanvas()._canvas);c.content.insertBefore(this.getCanvas()._canvas,b[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var c=this.getCanvas()._canvas;return Kinetic.Node.prototype.remove.call(this),c&&c.parentNode&&Kinetic.Util._isInDocument(c)&&c.parentNode.removeChild(c),this},getStage:function(){return this.parent}});
Kinetic.Util.extend(Kinetic.BaseLayer,Kinetic.Container);Kinetic.Factory.addGetterSetter(Kinetic.BaseLayer,"clearBeforeDraw",!0);Kinetic.Collection.mapMethods(Kinetic.BaseLayer)}();
!function(){Kinetic.Util.addMethods(Kinetic.FastLayer,{____init:function(c){this.nodeType="Layer";this.canvas=new Kinetic.SceneCanvas;Kinetic.BaseLayer.call(this,c)},_validateAdd:function(c){"Shape"!==c.getType()&&Kinetic.Util.error("You may only add shapes to a fast layer.")},_setCanvasSize:function(c,b){this.canvas.setSize(c,b)},hitGraphEnabled:function(){return!1},getIntersection:function(){return null},drawScene:function(c){var b=this.getLayer();c=c||b&&b.getCanvas();return this.getClearBeforeDraw()&&
c.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,c),this},_applyTransform:function(c,b,a){a&&a._id===this._id||(c=c.getTransform().getMatrix(),b.transform(c[0],c[1],c[2],c[3],c[4],c[5]))},draw:function(){return this.drawScene(),this},clear:function(c){return this.getContext().clear(c),this},setVisible:function(c){return Kinetic.Node.prototype.setVisible.call(this,c),this.getCanvas()._canvas.style.display=c?"block":"none",this}});Kinetic.Util.extend(Kinetic.FastLayer,Kinetic.BaseLayer);
Kinetic.Collection.mapMethods(Kinetic.FastLayer)}();
!function(){var c=[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1}],b=c.length;Kinetic.Util.addMethods(Kinetic.Layer,{____init:function(a){this.nodeType="Layer";this.canvas=new Kinetic.SceneCanvas;this.hitCanvas=new Kinetic.HitCanvas;Kinetic.BaseLayer.call(this,a)},_setCanvasSize:function(a,b){this.canvas.setSize(a,b);this.hitCanvas.setSize(a,b)},_validateAdd:function(a){a=a.getType();"Group"!==a&&"Shape"!==a&&Kinetic.Util.error("You may only add groups and shapes to a layer.")},
getIntersection:function(a){var e,d,f,m;if(!this.hitGraphEnabled()||!this.isVisible())return null;for(d=0;b>d;d++){if(f=c[d],e=this._getIntersection({x:a.x+f.x,y:a.y+f.y}),m=e.shape)return m;if(!e.antialiased)return null}},_getIntersection:function(a){var b,c;a=this.hitCanvas.context._context.getImageData(a.x,a.y,1,1).data;var f=a[3];return 255===f?(b=Kinetic.Util._rgbToHex(a[0],a[1],a[2]),c=Kinetic.shapes["#"+b],{shape:c}):0<f?{antialiased:!0}:{}},drawScene:function(a,b){var c=this.getLayer(),c=
a||c&&c.getCanvas();return this._fire("beforeDraw",{node:this}),this.getClearBeforeDraw()&&c.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,c,b),this._fire("draw",{node:this}),this},_applyTransform:function(a,b,c){a=a.getAbsoluteTransform(c).getMatrix();b.transform(a[0],a[1],a[2],a[3],a[4],a[5])},drawHit:function(a,b){var c=this.getLayer(),f=a||c&&c.hitCanvas;return c&&c.getClearBeforeDraw()&&c.getHitCanvas().getContext().clear(),Kinetic.Container.prototype.drawHit.call(this,
f,b),this},clear:function(a){return this.getContext().clear(a),this.getHitCanvas().getContext().clear(a),this},setVisible:function(a){return Kinetic.Node.prototype.setVisible.call(this,a),a?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none"),this},enableHitGraph:function(){return this.setHitGraphEnabled(!0),this},disableHitGraph:function(){return this.setHitGraphEnabled(!1),
this}});Kinetic.Util.extend(Kinetic.Layer,Kinetic.BaseLayer);Kinetic.Factory.addGetterSetter(Kinetic.Layer,"hitGraphEnabled",!0);Kinetic.Collection.mapMethods(Kinetic.Layer)}();!function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(c){this.nodeType="Group";Kinetic.Container.call(this,c)},_validateAdd:function(c){c=c.getType();"Group"!==c&&"Shape"!==c&&Kinetic.Util.error("You may only add groups and shapes to groups.")}});Kinetic.Util.extend(Kinetic.Group,Kinetic.Container);Kinetic.Collection.mapMethods(Kinetic.Group)}();
!function(){Kinetic.Rect=function(c){this.___init(c)};Kinetic.Rect.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="Rect";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var b=this.getCornerRadius(),a=this.getWidth(),e=this.getHeight();c.beginPath();b?(c.moveTo(b,0),c.lineTo(a-b,0),c.arc(a-b,b,b,3*Math.PI/2,0,!1),c.lineTo(a,e-b),c.arc(a-b,e-b,b,0,Math.PI/2,!1),c.lineTo(b,e),c.arc(b,e-b,b,Math.PI/2,Math.PI,!1),c.lineTo(0,b),c.arc(b,b,b,Math.PI,3*Math.PI/2,!1)):c.rect(0,
0,a,e);c.closePath();c.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Rect,"cornerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Rect)}();
!function(){var c=2*Math.PI-1E-4;Kinetic.Circle=function(b){this.___init(b)};Kinetic.Circle.prototype={___init:function(b){Kinetic.Shape.call(this,b);this.className="Circle";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){b.beginPath();b.arc(0,0,this.getRadius(),0,c,!1);b.closePath();b.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(b){Kinetic.Node.prototype.setWidth.call(this,b);this.setRadius(b/2)},setHeight:function(b){Kinetic.Node.prototype.setHeight.call(this,
b);this.setRadius(b/2)}};Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Circle,"radius",0);Kinetic.Collection.mapMethods(Kinetic.Circle)}();
!function(){Kinetic.Image=function(c){this.___init(c)};Kinetic.Image.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="Image";this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},_sceneFunc:function(c){var b,a,e,d,f=this.getWidth(),m=this.getHeight(),k=this.getImage();k&&(b=this.getCrop(),a=b.width,e=b.height,d=a&&e?[k,b.x,b.y,a,e,0,0,f,m]:[k,0,0,f,m]);c.beginPath();
c.rect(0,0,f,m);c.closePath();c.fillStrokeShape(this);k&&c.drawImage.apply(c,d)},_hitFunc:function(c){var b=this.getWidth(),a=this.getHeight();c.beginPath();c.rect(0,0,b,a);c.closePath();c.fillStrokeShape(this)},getWidth:function(){var c=this.getImage();return this.attrs.width||(c?c.width:0)},getHeight:function(){var c=this.getImage();return this.attrs.height||(c?c.height:0)}};Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Image,"image");Kinetic.Factory.addComponentsGetterSetter(Kinetic.Image,
"crop",["x","y","width","height"]);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropX",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropY",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropWidth",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropHeight",0);Kinetic.Collection.mapMethods(Kinetic.Image)}();
!function(){function c(a){a.fillText(this.partialText,0,0)}function b(a){a.strokeText(this.partialText,0,0)}var a="fontFamily fontSize fontStyle fontVariant padding align lineHeight text width height wrap".split(" "),e=a.length,d=Kinetic.Util.createCanvasElement().getContext("2d");Kinetic.Text=function(a){this.___init(a)};Kinetic.Text.prototype={___init:function(d){void 0===d.width&&(d.width="auto");void 0===d.height&&(d.height="auto");Kinetic.Shape.call(this,d);this._fillFunc=c;this._strokeFunc=
b;this.className="Text";for(d=0;e>d;d++)this.on(a[d]+"Change.kinetic",this._setTextData);this._setTextData();this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_sceneFunc:function(a){var b,c=this.getPadding();b=this.getTextHeight();var d=this.getLineHeight()*b,e=this.textArr,l=e.length,q=this.getWidth();a.setAttr("font",this._getContextFont());a.setAttr("textBaseline","middle");a.setAttr("textAlign","left");a.save();a.translate(c,0);a.translate(0,c+b/2);for(b=0;l>b;b++){var n=e[b],p=n.text,
n=n.width;a.save();"right"===this.getAlign()?a.translate(q-n-2*c,0):"center"===this.getAlign()&&a.translate((q-n-2*c)/2,0);this.partialText=p;a.fillStrokeShape(this);a.restore();a.translate(0,d)}a.restore()},_hitFunc:function(a){var b=this.getWidth(),c=this.getHeight();a.beginPath();a.rect(0,0,b,c);a.closePath();a.fillStrokeShape(this)},setText:function(a){a=Kinetic.Util._isString(a)?a:a.toString();return this._setAttr("text",a),this},getWidth:function(){return"auto"===this.attrs.width?this.getTextWidth()+
2*this.getPadding():this.attrs.width},getHeight:function(){return"auto"===this.attrs.height?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(a){var b,c=this.getFontSize();return d.save(),d.font=this._getContextFont(),b=d.measureText(a),d.restore(),{width:b.width,height:parseInt(c,10)}},_getContextFont:function(){return this.getFontStyle()+
" "+this.getFontVariant()+" "+this.getFontSize()+"px "+this.getFontFamily()},_addTextLine:function(a,b){return this.textArr.push({text:a,width:b})},_getTextWidth:function(a){return d.measureText(a).width},_setTextData:function(){var a=this.getText().split("\n"),b=+this.getFontSize(),c=0,e=this.getLineHeight()*b,h=this.attrs.width,l=this.attrs.height,q="auto"!==h,n="auto"!==l,p=this.getPadding(),h=h-2*p,l=l-2*p,p=0,r=this.getWrap(),s="none"!==r,r="char"!==r&&s;this.textArr=[];d.save();d.font=this._getContextFont();
for(var u=0,A=a.length;A>u;++u){var t=a[u],v=this._getTextWidth(t);if(q&&v>h)for(;0<t.length;){for(var x=0,y=t.length,w="",z=0;y>x;){var B=x+y>>>1,C=t.slice(0,B+1),D=this._getTextWidth(C);h>=D?(x=B+1,w=C,z=D):y=B}if(!w)break;r&&(y=Math.max(w.lastIndexOf(" "),w.lastIndexOf("-"))+1,0<y&&(x=y,w=w.slice(0,x),z=this._getTextWidth(w)));if(this._addTextLine(w,z),c=Math.max(c,z),p+=e,!s||n&&p+e>l)break;if(t=t.slice(x),0<t.length&&(v=this._getTextWidth(t),h>=v)){this._addTextLine(t,v);p+=e;c=Math.max(c,v);
break}}else this._addTextLine(t,v),p+=e,c=Math.max(c,v);if(n&&p+e>l)break}d.restore();this.textHeight=b;this.textWidth=c}};Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontFamily","Arial");Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontSize",12);Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontStyle","normal");Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontVariant","normal");Kinetic.Factory.addGetterSetter(Kinetic.Text,"padding",0);Kinetic.Factory.addGetterSetter(Kinetic.Text,
"align","left");Kinetic.Factory.addGetterSetter(Kinetic.Text,"lineHeight",1);Kinetic.Factory.addGetterSetter(Kinetic.Text,"wrap","word");Kinetic.Factory.addGetter(Kinetic.Text,"text","");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Text,"text");Kinetic.Collection.mapMethods(Kinetic.Text)}();
!function(){Kinetic.RegularPolygon=function(c){this.___init(c)};Kinetic.RegularPolygon.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="RegularPolygon";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var b,a,e,d=this.attrs.sides,f=this.attrs.radius;c.beginPath();c.moveTo(0,0-f);for(b=1;d>b;b++)a=f*Math.sin(2*b*Math.PI/d),e=-1*f*Math.cos(2*b*Math.PI/d),c.lineTo(a,e);c.closePath();c.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,
"radius",0);Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"sides",0);Kinetic.Collection.mapMethods(Kinetic.RegularPolygon)}();