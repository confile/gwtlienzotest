(function(){function s(c,a,d){var b=document.createElement("canvas");r(c,b,a,d);return b.toDataURL("image/jpeg",a.quality||0.8)}function r(c,a,d,b){var l=c.naturalWidth,f=c.naturalHeight,e=d.width,k=d.height,m=a.getContext("2d");m.save();d=d.orientation;switch(d){case 5:case 6:case 7:case 8:a.width=k;a.height=e;break;default:a.width=e,a.height=k}a=a.getContext("2d");switch(d){case 2:a.translate(e,0);a.scale(-1,1);break;case 3:a.translate(e,k);a.rotate(Math.PI);break;case 4:a.translate(0,k);a.scale(1,
-1);break;case 5:a.rotate(0.5*Math.PI);a.scale(1,-1);break;case 6:a.rotate(0.5*Math.PI);a.translate(0,-k);break;case 7:a.rotate(0.5*Math.PI);a.translate(e,-k);a.scale(-1,1);break;case 8:a.rotate(-0.5*Math.PI),a.translate(-e,0)}a=c.naturalWidth;1048576<a*c.naturalHeight?(d=document.createElement("canvas"),d.width=d.height=1,d=d.getContext("2d"),d.drawImage(c,-a+1,0),a=0===d.getImageData(0,0,1,1).data[3]):a=!1;a&&(l/=2,f/=2);a=document.createElement("canvas");a.width=a.height=1024;d=a.getContext("2d");
if(b){b=f;var g=document.createElement("canvas");g.width=1;g.height=b;g=g.getContext("2d");g.drawImage(c,0,0);for(var g=g.getImageData(0,0,1,b).data,h=0,n=b,p=b;p>h;)0===g[4*(p-1)+3]?n=p:h=p,p=n+h>>1;b=p/b;b=0===b?1:b}else b=1;e=Math.ceil(1024*e/l);k=Math.ceil(1024*k/f/b);for(g=b=0;b<f;){for(n=h=0;h<l;)d.clearRect(0,0,1024,1024),d.drawImage(c,-h,-b),m.drawImage(a,0,0,1024,1024,n,g,e,k),h+=1024,n+=e;b+=1024;g+=k}m.restore()}function q(c){if(window.Blob&&c instanceof Blob){var a=new Image,d=window.URL&&
window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!d)throw Error("No createObjectURL function found to create blob url");a.src=d.createObjectURL(c);this.blob=c;c=a}if(!c.naturalWidth&&!c.naturalHeight){var b=this;c.onload=function(){var a=b.imageLoadListeners;if(a){b.imageLoadListeners=null;for(var c=0,d=a.length;c<d;c++)a[c]()}};this.imageLoadListeners=[]}this.srcImage=c}q.prototype.render=function(c,a){if(this.imageLoadListeners){var d=
this;this.imageLoadListeners.push(function(){d.render(c,a)})}else{a=a||{};var b=this.srcImage.naturalWidth,l=this.srcImage.naturalHeight,f=a.width,e=a.height,k=a.maxWidth,m=a.maxHeight,g=!this.blob||"image/jpeg"===this.blob.type;f&&!e?e=l*f/b<<0:e&&!f?f=b*e/l<<0:(f=b,e=l);k&&f>k&&(f=k,e=l*f/b<<0);m&&e>m&&(e=m,f=b*e/l<<0);var b={width:f,height:e},h;for(h in a)b[h]=a[h];h=c.tagName.toLowerCase();"img"===h?c.src=s(this.srcImage,b,g):"canvas"===h&&r(this.srcImage,c,b,g);if("function"===typeof this.onrender)this.onrender(c)}};
"function"===typeof define&&define.amd?define([],function(){return q}):this.MegaPixImage=q})();